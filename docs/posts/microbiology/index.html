<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.543">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Buell, Kaveri Chhikara">
<meta name="dcterms.date" content="2024-07-03">

<title>CLIF Consortium - CLIF Microbiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CLIF Consortium</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">TEAM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../data-dictionary.html"> 
<span class="menu-text">Data Dictionary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kaveriC/CLIF-1.0/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">CLIF Microbiology</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">ehr-to-clif</div>
                <div class="quarto-category">microbiology</div>
                <div class="quarto-category">ERD</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kevin Buell, Kaveri Chhikara </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 3, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#desired-clif-table-structure" id="toc-desired-clif-table-structure" class="nav-link" data-scroll-target="#desired-clif-table-structure">Desired CLIF Table Structure</a></li>
  <li><a href="#documents-to-facilitate-cleaning-data" id="toc-documents-to-facilitate-cleaning-data" class="nav-link" data-scroll-target="#documents-to-facilitate-cleaning-data">Documents to facilitate cleaning data</a></li>
  </ul></li>
  <li><a href="#step-1-identify-fluid-names-ordering-infectious-studies" id="toc-step-1-identify-fluid-names-ordering-infectious-studies" class="nav-link" data-scroll-target="#step-1-identify-fluid-names-ordering-infectious-studies">Step 1: Identify Fluid Names Ordering Infectious Studies</a></li>
  <li><a href="#step-2-reclassify-fluid-categories" id="toc-step-2-reclassify-fluid-categories" class="nav-link" data-scroll-target="#step-2-reclassify-fluid-categories">Step 2: Reclassify Fluid Categories</a></li>
  <li><a href="#step-3-create-component-categories" id="toc-step-3-create-component-categories" class="nav-link" data-scroll-target="#step-3-create-component-categories">Step 3: Create Component categories</a></li>
  <li><a href="#step-4-categorize-organism-name-strings" id="toc-step-4-categorize-organism-name-strings" class="nav-link" data-scroll-target="#step-4-categorize-organism-name-strings">Step 4: Categorize Organism Name Strings</a></li>
  <li><a href="#step-5-final-steps-to-clean-the-data" id="toc-step-5-final-steps-to-clean-the-data" class="nav-link" data-scroll-target="#step-5-final-steps-to-clean-the-data">Step 5: Final Steps to Clean the Data</a></li>
  <li><a href="#potential-additional-steps" id="toc-potential-additional-steps" class="nav-link" data-scroll-target="#potential-additional-steps">Potential additional steps</a>
  <ul class="collapse">
  <li><a href="#notes-on-cde-nih-infection-site" id="toc-notes-on-cde-nih-infection-site" class="nav-link" data-scroll-target="#notes-on-cde-nih-infection-site">Notes on CDE NIH Infection Site</a></li>
  <li><a href="#notes-on-the-cde-organism-table" id="toc-notes-on-the-cde-organism-table" class="nav-link" data-scroll-target="#notes-on-the-cde-organism-table">Notes on the CDE Organism table</a></li>
  <li><a href="#common-problems-encountered" id="toc-common-problems-encountered" class="nav-link" data-scroll-target="#common-problems-encountered">Common Problems Encountered</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This guide provides detailed steps on how to construct the CLIF microbiology table using EHR data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="schema.png" class="quarto-figure quarto-figure-center figure-img" width="300" height="400"></p>
</figure>
</div>
<section id="desired-clif-table-structure" class="level3">
<h3 class="anchored" data-anchor-id="desired-clif-table-structure">Desired CLIF Table Structure</h3>
<ul>
<li>encounter_id</li>
<li>test_id: For one component (e.g., gram culture smear) for a given fluid with a unique order and collection time. If two pathogens are identified, this yields two rows with the same test_id.</li>
<li>organism_id: For one culture for a given fluid with a unique order and collection time, linked to a separate sensitivity table. If two pathogens are identified, this yields two rows with the same culture_id.</li>
<li>order_dttm</li>
<li>collect_dttm</li>
<li>result_dttm</li>
<li>fluid_name</li>
<li>fluid_category (Defined by NIH CDE)</li>
<li>organism_name</li>
<li>organism_category (Defined by NIH CDE)</li>
</ul>
</section>
<section id="documents-to-facilitate-cleaning-data" class="level3">
<h3 class="anchored" data-anchor-id="documents-to-facilitate-cleaning-data">Documents to facilitate cleaning data</h3>
<ol type="1">
<li><a href="https://github.com/kaveriC/CLIF-1.0/blob/main/mCIDE/clif_nih_vocab_microbiology_organism.csv">CDE NIH Organism</a>: List of categorized organism names defined by NIH.</li>
<li><a href="https://github.com/kaveriC/CLIF-1.0/blob/main/mCIDE/ucmc/clif_vocab_microbiology_organism_ucmc.csv">clif_vocab_microbiology_organism_ucmc.csv</a>: Helps categorize organism name strings.</li>
<li><a href="https://github.com/kaveriC/CLIF-1.0/blob/main/mCIDE/clif_nih_vocab_microbiology_fluid.csv">CDE NIH Infection Site</a>: List of categorized infectious fluid names defined by NIH.</li>
<li><a href="https://github.com/kaveriC/CLIF-1.0/blob/main/mCIDE/ucmc/clif_vocab_microbiology_fluid_ucmc.csv">clif_vocab_microbiology_fluid_ucmc.csv</a>: Identifies and categorizes infectious fluid names.</li>
</ol>
</section>
</section>
<section id="step-1-identify-fluid-names-ordering-infectious-studies" class="level2">
<h2 class="anchored" data-anchor-id="step-1-identify-fluid-names-ordering-infectious-studies">Step 1: Identify Fluid Names Ordering Infectious Studies</h2>
<p>To begin cleaning your CLIF micro data, you first need to identify fluid names that order an infectious study. If your dataset contains all labs ordered at your site, you need to filter out those specific to infectious cultures. The <a href="https://github.com/kaveriC/CLIF-1.0/blob/main/mCIDE/ucmc/clif_vocab_microbiology_fluid_ucmc.csv">clif_vocab_microbiology_fluid_ucmc</a> table contains a list of infectious fluid names that map to the fluid category. Here’s how you can do it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>fluid_name_ontology <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"pathway"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), tolower)) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(culture <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>culture)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, check for other infectious orders that need to be included in your site’s fluid names:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Data <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(fluid_category)) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(fluid_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Look at the table for any infectious fluid names that the <code>micro_ontology</code> table did not pick up. You will need to include these.</p>
<p>You can then either:</p>
<ul>
<li>Update the micro_ontology table and repeat the left bind.</li>
<li>Use case_when(fluid_name == ____) then fluid category is ____.</li>
</ul>
</section>
<section id="step-2-reclassify-fluid-categories" class="level2">
<h2 class="anchored" data-anchor-id="step-2-reclassify-fluid-categories">Step 2: Reclassify Fluid Categories</h2>
<p>Reclassify <code>fluid_category == “other unspecified”</code> into a more specific category using <code>case_when</code> or <code>grepl</code>. With this approach, about 30% of fluid names might be left bound to the <code>fluid_category "other unspecified"</code> because the fluid name does not contain any description of where the fluid originates from.</p>
<p>Reclassify these “other_unspecified” cultures into their correct fluid_category. At UoC, the <code>fluid_description</code> is a string typed in by the clinician in EPIC and is therefore the correct <code>fluid_category</code>.</p>
<p>In the below example, we reclassify fluid categories for brain and eyes:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify fluid categories for brain</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sipa_data.brain.pre <span class="ot">&lt;-</span> sipa_data.v7 <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fluid_category <span class="sc">==</span> <span class="st">"other unspecified"</span> <span class="sc">|</span> fluid_category <span class="sc">==</span> <span class="st">"brain"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fluid_category =</span> <span class="fu">case_when</span>(component_name <span class="sc">==</span> <span class="st">"specimen description"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"brain"</span>, ord_value, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"brain"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="cn">TRUE</span> <span class="sc">~</span> fluid_category)) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify fluid categories for eyes</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>sipa_data.eyes.pre <span class="ot">&lt;-</span> sipa_data.v7 <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fluid_category <span class="sc">==</span> <span class="st">"other unspecified"</span> <span class="sc">|</span> fluid_category <span class="sc">==</span> <span class="st">"eyes"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fluid_category =</span> <span class="fu">case_when</span>(component_name <span class="sc">==</span> <span class="st">"specimen description"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"conjunctival|conjunctivall|corneal|corneal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ensure that your reclassification is correct by checking for coherenc. Be careful with your grepl term because it is EXTREMELY easy to miscategorise fluids.</p>
<p>For instance, <code>bladder</code> could be <code>gallbladder</code>or <code>urinary bladder</code></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Data <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fluid_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(fluid_name, <span class="st">"bladder"</span>) <span class="sc">~</span> <span class="st">"urinary bladder"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> fluid_category</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After every grepl/case_when, you need to</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Data <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fluid_category <span class="sc">==</span> <span class="st">"fluid_category"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(fluid_names, fluid_category)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Look at the table to see that the pairings are coherent.</p>
</section>
<section id="step-3-create-component-categories" class="level2">
<h2 class="anchored" data-anchor-id="step-3-create-component-categories">Step 3: Create Component categories</h2>
<p>The type of fluid name should be specified. There are three levels for this: Culture, Gram stain, and Smear.</p>
<p>Since there were few component names at UoC, an ontology table wasn’t created. Instead, you can use case_when to create a new column for <code>component_category</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Data <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">component_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(component_name, <span class="st">"gram stain"</span>) <span class="sc">~</span> <span class="st">"Gram stain"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(component_name, <span class="st">"smear"</span>) <span class="sc">~</span> <span class="st">"Smear"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Culture"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-categorize-organism-name-strings" class="level2">
<h2 class="anchored" data-anchor-id="step-4-categorize-organism-name-strings">Step 4: Categorize Organism Name Strings</h2>
<p>Categorize organism name strings into <code>organism_name</code> and <code>organism_category</code> by left binding the <a href="https://github.com/kaveriC/CLIF-1.0/blob/main/mCIDE/ucmc/clif_vocab_microbiology_organism_ucmc.csv">clif_vocab_microbiology_organism_ucmc.csv</a> table:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="step4.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">&lt;-</span> Data <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(micro_name_ontology, <span class="at">by =</span> <span class="st">"organism_string"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Check for organism strings that did not get captured with the left bind:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Data <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(organism_category)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(organism_string)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Include any missing organism strings by either:</p>
<ul>
<li>Using case_when for specific strings.</li>
<li>Updating the organism_name_ontology table manually and repeating the left bind.</li>
</ul>
<p>For updating the organism name ontology table, you could also use the <a href="https://chatgpt.com/g/g-h1nk6d3eR-clif-assistant">CLIF Assitant</a>. You can feed CLIF assistant your strings. It can help you classify them into organism_names and organism_categories.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="step4_ca.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="step-5-final-steps-to-clean-the-data" class="level2">
<h2 class="anchored" data-anchor-id="step-5-final-steps-to-clean-the-data">Step 5: Final Steps to Clean the Data</h2>
<section id="create-test-id-and-culture-id" class="level4">
<h4 class="anchored" data-anchor-id="create-test-id-and-culture-id">Create Test ID and Culture ID</h4>
<p>A test_id is a unique number that identifies one patient, one infectious lab (fluid_name) collected at one time point, and its component_name.</p>
<p>A culture_id is a unique number that identifies one patient, one infectious lab (fluid_name) collected at one time point, and its component_name for a culture.</p>
</section>
</section>
<section id="potential-additional-steps" class="level2">
<h2 class="anchored" data-anchor-id="potential-additional-steps">Potential additional steps</h2>
<p>Whether or not you need to perform these additional steps depends on how many redundant string rows your dataset has</p>
<ol type="1">
<li><strong>Remove Duplicate Rows</strong></li>
</ol>
<ul>
<li>To remove duplicate rows, use the following R code:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(encounter_id, order_dttm, collect_dttm, result_dttm, fluid_name, fluid_category, component_name, component_category, organism_name, organism_category, susceptibility_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>One organism collected from a patient, from one body fluid, at one time, growing one bug, with a set susceptibility pattern should take up one row
<ul>
<li>If two different bugs grow from same culture, they take up two rows</li>
<li>If two identical bugs grow with different susceptibility profile, they take up two rows</li>
</ul></li>
</ul>
<ol start="2" type="1">
<li>Review additional rows of</li>
</ol>
<ul>
<li><p>No growth</p>
<ul>
<li>Example that no growth should be removed. The below screenshot is one culture. The <code>“no growth”</code> of <code>“no bacteroides fragilis group or clostridium perfringes isolated”</code> comes from left bind. It is not appropriate given the culture actually grows pseudomonas.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="nogrowth.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div></li>
<li><p>Other bacteria</p>
<ul>
<li>Example that other bacteria should be removed. We ultimately want one row showing the growth enterococcus and not <code>“other bacteria”</code></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="otherbac.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div></li>
</ul>
<section id="notes-on-cde-nih-infection-site" class="level3">
<h3 class="anchored" data-anchor-id="notes-on-cde-nih-infection-site">Notes on CDE NIH Infection Site</h3>
<table class="table">
<colgroup>
<col style="width: 75%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Category</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Catheter tip</strong></td>
<td>Includes central venous catheter tips and pacemaker leads.</td>
</tr>
<tr class="even">
<td><strong>GI tract unspecified</strong></td>
<td>Use only if it cannot be categorized into esophagus, stomach, small intestine, or large intestine.</td>
</tr>
<tr class="odd">
<td></td>
<td>Interpreted as a luminal GI source.</td>
</tr>
<tr class="even">
<td><strong>Genito-urinary tract unspecified</strong></td>
<td>Use for urine cultures.</td>
</tr>
<tr class="odd">
<td></td>
<td>Includes kidney, renal pelvis, ureters, and bladder.</td>
</tr>
<tr class="even">
<td></td>
<td>Use for stents, tissue, abscess, cysts, etc.</td>
</tr>
<tr class="odd">
<td><strong>Rash, pustules, or abscesses not typical of any of the above</strong></td>
<td>Interpreted as a superficial skin pustular source.</td>
</tr>
<tr class="even">
<td></td>
<td>Does not include deep abscesses (e.g., psoas abscess).</td>
</tr>
<tr class="odd">
<td><strong>Lower respiratory tract (lung)</strong></td>
<td>Includes all respiratory samples such as tracheal samples, BAL, induced and normal sputum, TBBx, and lung abscesses.</td>
</tr>
<tr class="even">
<td></td>
<td>Typically, fluids are not categorized as “respiratory tract unspecified”.</td>
</tr>
<tr class="odd">
<td></td>
<td>Respiratory fluids are complicated to classify; use specimen_description to further classify fluid location (e.g., BAL vs sputum vs trach).</td>
</tr>
<tr class="even">
<td><strong>Joints</strong></td>
<td>Includes samples from within the joint (e.g., synovial, bursa).</td>
</tr>
<tr class="odd">
<td></td>
<td>Does not include overlying skin or muscle.</td>
</tr>
<tr class="even">
<td><strong>Spinal cord</strong></td>
<td>Does not include vertebral osteomyelitis, which falls under “bone cortex (osteomyelitis)”.</td>
</tr>
<tr class="odd">
<td><strong>Wound site</strong></td>
<td>Includes infected incisions.</td>
</tr>
<tr class="even">
<td></td>
<td>Does not capture ulcers, as it is often unclear if the ulcer is skin-only vs muscle/fascia vs bone.</td>
</tr>
</tbody>
</table>
</section>
<section id="notes-on-the-cde-organism-table" class="level3">
<h3 class="anchored" data-anchor-id="notes-on-the-cde-organism-table">Notes on the CDE Organism table</h3>
<table class="table">
<colgroup>
<col style="width: 75%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Category</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Organism_name structure</strong></td>
<td>Structured as “genus_species”.</td>
</tr>
<tr class="even">
<td></td>
<td>If the species is not available, use “genus_sp”.</td>
</tr>
<tr class="odd">
<td><strong>Obligatory anaerobes</strong></td>
<td>Check if the bacteria is an obligatory anaerobe.</td>
</tr>
<tr class="even">
<td></td>
<td>Classified into “anaerobic bacteria (nos, except for bacteroides, clostridium)”.</td>
</tr>
<tr class="odd">
<td><strong>Gram +/- without genus/species</strong></td>
<td>For strings of “gram +/- without genus/species”, use the corresponding categories for fluid_cat.</td>
</tr>
<tr class="even">
<td></td>
<td>Apply that category in fluid_name as well.</td>
</tr>
</tbody>
</table>
</section>
<section id="common-problems-encountered" class="level3">
<h3 class="anchored" data-anchor-id="common-problems-encountered">Common Problems Encountered</h3>
<ul>
<li><p><strong>Describing Organisms</strong>:</p>
<ul>
<li>There are tens of thousands of strings to describe organisms (e.g., 100,000 CFU E coli, Esch. Coli, E.Coli, etc.).</li>
<li>Use ontology tables to left_bind and map out organism strings to “organism_name” (genus_species) and “organism_category” (as determined by NIH CDE).</li>
<li>For instance, this is a snapshort of 20 records only for negative gram stain and Enterobacter + culture!</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="problem1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div></li>
<li><p><strong>Duplicated Data</strong>:</p>
<ul>
<li>As one microbiology result can be spread over many rows, left_binding 1:1 using the microbiology ontology tables may create duplicates.</li>
<li>These duplicates will need to be addressed later.</li>
</ul></li>
<li><p><strong>Non-descriptive Fluid Names</strong>:</p>
<ul>
<li>Some fluid names describe where the micro fluid is collected (e.g., blood culture anaerobic and aerobic), but many do not (e.g., anaerobic culture, I&amp;D).</li>
<li>Use other dataset columns, such as “specimen_description” or “source”, to recategorize cultures whose location is not obvious from the “fluid_name”.</li>
<li>For instance, At UoC, we have a separate component == “specimen description” that further describes fluid collection. UoW and Northshore also had something similar.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="problem3.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div></li>
<li><p><strong>Multiple Strings for Components</strong>:</p>
<ul>
<li>There are multiple strings to describe each component of a fluid_name (e.g., gram stain, gram for anaerobic stain, gramstain, etc.).</li>
<li>Different fluid names have components specific to them (e.g., only bacterial cultures have gram stains).</li>
</ul></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© 2024 · Made with <a href="https://quarto.org/"><img src="https://quarto.org/quarto.png" class="img-fluid" alt="Quarto" width="65"></a></p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kaveriC/clif-consortium/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>